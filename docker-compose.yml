version: "3.8"

services:
    mongodb:
        image: mongo:latest
        container_name: mongodb
        restart: always
        environment:
            - MONGO_INITDB_ROOT_USERNAME=root
            - MONGO_INITDB_ROOT_PASSWORD=example
        command: ["mongod", "--bind_ip", "0.0.0.0"]
        volumes:
            - mongodb_data:/data/db
            - ./init:/docker-entrypoint-initdb.d
        ports:
            - "27018:27017"
        networks:
            - app-network

    mongo-backup:
        build:
            context: ./mongo-backup
            dockerfile: Dockerfile
        restart: always
        environment:
            - EMAIL_TO=hsairam261@gmail.com
            - SMTP_SERVER=smtp.gmail.com
            - SMTP_USER=26thofficial.creator@gmail.com
            - SMTP_PASS=yaubfifsjunosrjv
            - MONGO_HOST=mongodb
            - MONGO_PORT=27017
            - MONGO_USER=root
            - MONGO_PASS=example
            - MONGO_AUTH_DB=admin
            - RCLONE_DRIVE=docker
        volumes:
            - ./mongo-backups:/backup
        depends_on:
            - mongodb
        networks:
            - app-network

    compass-web:
        image: haohanyang/compass-web
        container_name: compass-web
        restart: always
        environment:
            - CW_MONGO_URI=mongodb://root:example@mongodb:27017/admin
        depends_on:
            - mongodb
        ports:
            - "8080:8080"
        networks:
            - app-network

volumes:
    mongodb_data:

networks:
    app-network:
        driver: bridge
